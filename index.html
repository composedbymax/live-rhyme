<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rhyme Finder</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; padding: 2rem; }
    select, input { margin: 0.5rem; padding: 0.5rem; background: #222; color: #eee; border: 1px solid #555; }
    ul { list-style: none; padding: 0; }
    li { margin: 0.2rem 0; }
  </style>
</head>
<body>
  <h1>Rhyme Generator</h1>
  <p id="status">Loading phonetic dictionary...</p>
  <input type="text" id="inputWord" placeholder="Enter a word" />
  <select id="rhymeType">
    <option value="perfect">Perfect Rhyme</option>
    <option value="assonance">Assonance</option>
    <option value="slant">Slant Rhyme</option>
    <option value="pararhyme">Pararhyme</option>
    <option value="multisyllabic">Multisyllabic Rhyme</option>
    <option value="eye">Eye Rhyme</option>
  </select>
  <button onclick="search()">Find Rhymes</button>
  <div id="results"></div>
  <script>
    let cmu = {};
    let wordList = [];
    async function loadCMU() {
      const res = await fetch("cmudict.json");
      cmu = await res.json();
      wordList = Object.keys(cmu);
      document.getElementById("status").innerText = "Phonetic dictionary loaded.";
    }
    function countSyllables(pronunciation) {
      return (pronunciation.match(/[0-2]/g) || []).length;
    }
    function getRhymePart(pronunciation) {
      const phones = pronunciation.trim().split(" ");
      for (let i = phones.length - 1; i >= 0; i--) {
        if (phones[i].match(/\d/)) {
          return phones.slice(i).join(" ");
        }
      }
      return phones.join(" ");
    }
    function getAssonance(pronunciation) {
      return pronunciation.match(/[AEIOU][A-Z]*[0-2]?/g) || [];
    }
    function normalizeWord(word) {
      return word.toUpperCase().replace(/[^A-Z]/g, '');
    }
    function matchRhyme(word, type) {
        word = normalizeWord(word);
        const results = [];
        if (!cmu[word]) return results;
        const targetPronunciations = Array.isArray(cmu[word]) ? cmu[word] : [cmu[word]];
        wordList.forEach(candidate => {
            if (candidate === word) return;
            const candidateProns = Array.isArray(cmu[candidate]) ? cmu[candidate] : [cmu[candidate]];
            candidateProns.forEach(pron => {
            targetPronunciations.forEach(targetPron => {
                let match = false;
                if (type === "perfect") {
                match = getRhymePart(pron) === getRhymePart(targetPron);
                } else if (type === "assonance") {
                const a1 = getAssonance(pron).join("-");
                const a2 = getAssonance(targetPron).join("-");
                match = a1 === a2;
                } else if (type === "slant") {
                const rhyme1 = getRhymePart(pron).replace(/\d/g, '');
                const rhyme2 = getRhymePart(targetPron).replace(/\d/g, '');
                match = rhyme1 === rhyme2;
                } else if (type === "pararhyme") {
                const cons1 = pron.replace(/[AEIOU][A-Z]*[0-2]?/g, "");
                const cons2 = targetPron.replace(/[AEIOU][A-Z]*[0-2]?/g, "");
                match = cons1 === cons2;
                } else if (type === "multisyllabic") {
                match = getRhymePart(pron) === getRhymePart(targetPron) &&
                        countSyllables(pron) > 1;
                } else if (type === "eye") {
                match = candidate.slice(-3) === word.slice(-3);
                }
                if (match) {
                results.push({
                    word: candidate,
                    syllables: countSyllables(pron)
                });
                }
            });
            });
        });
        results.sort((a, b) => a.syllables - b.syllables);
        return results;
        }
    function search() {
      const word = document.getElementById("inputWord").value;
      const type = document.getElementById("rhymeType").value;
      const output = document.getElementById("results");
      const matches = matchRhyme(word, type);
      output.innerHTML = `<h3>${matches.length} matches found</h3><ul>` +
        matches.map(m => `<li>${m.word.toLowerCase()} (${m.syllables} syllables)</li>`).join("") +
        "</ul>";
    }
    window.onload = loadCMU;
  </script>
</body>
</html>