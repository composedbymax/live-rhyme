<!--
 _      ___ __     __ _____ 
| |    |_ _|\ \   / /| ____|
| |___  | |  \ \ / / |  _|  
|_____||___|  \_\_/  |_____|
 ____   _   _ __   __ __  __  _____  _  _ 
|  _ \ | | | | \\ // |  \/  || ____|| || |
| |_) || |_| |  V V  | |\/| ||  _|  |_||_|
|_| \_\|_| |_|  |_|  |_|  |_||_____|(_)(_)
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rhyme Finder with Speech</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--bg:#1e1e1e;--bg-light:rgba(0,0,0,0.2);--accent:#24deeb;--red:#e45a33;--text:#c7c7c7;--text-dark:#000}
    body{background:#2d2d2d;font-family:system-ui, sans-serif;display:flex;align-items:center;justify-content:center;min-height:100vh;padding:1rem}
    #app{background:var(--bg-light);color:var(--text);border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.5);width:100%;max-width:1200px;padding:2rem;transition:min-height 0.3s}
    #app.expanded{min-height:92vh}
    h1{text-align:center;margin-bottom:1rem;font-weight:400;color:var(--accent)}
    #status{text-align:center;color:var(--text);font-size:0.9rem;margin-bottom:1.5rem}
    #controls{display:flex;align-items:center;flex-wrap:wrap;gap:1rem;justify-content:center;margin-bottom:2rem}
    #inputWord{flex:1 1 200px;padding:0.8rem;background:var(--bg);border:1px solid var(--accent);border-radius:6px;color:var(--text);font-size:1rem}
    #micBtn{background:var(--red);border:none;border-radius:12px;cursor:pointer;outline:none;display:flex;align-items:center;justify-content:center;width:1.9rem;height:2.4rem}
    .types{display:grid;grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));gap:0.5rem;flex:1 1 300px}
    .types label{display:flex;align-items:center;background:var(--bg);padding:0.5rem;border-radius:6px;cursor:pointer;user-select:none;font-size:0.9rem}
    .types input{margin-right:0.5rem;accent-color:var(--accent)}
    #results{display:grid;grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));gap:1rem}
    .rhyme-col{background:var(--bg);border-radius:6px;padding:0.8rem;display:flex;flex-direction:column;max-height:60vh;overflow-y:auto}
    .rhyme-col h2{margin-bottom:0.5rem;font-size:1rem;color:var(--accent);text-transform:capitalize;text-align:center}
    .words{display:flex;flex-direction:column;gap:0.4rem}
    .word{background:var(--text-dark);padding:0.4rem 0.6rem;border-radius:4px;cursor:pointer;font-size:0.85rem;transition:background 0.2s, color 0.2s;color:var(--text)}
    .word:hover{background:var(--accent);color:var(--text-dark)}
    #banner{position:fixed;top:1rem;left:50%;transform:translateX(-50%);background:var(--accent);color:var(--text-dark);padding:0.6rem 1rem;border-radius:4px;opacity:0;pointer-events:none;transition:opacity 0.3s;font-size:0.9rem;z-index:100}
    #banner.show{opacity:1}
  </style>
</head>
<body>
  <div id="app">
    <h1>Rhyme Finder</h1>
    <p id="status">Loading phonetic dictionary…</p>
    <div id="controls">
      <input type="text" id="inputWord" name="word" placeholder="Enter a word…" autocomplete="off" />
      <button id="micBtn" title="Toggle speech recognition">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
            <line x1="12" y1="19" x2="12" y2="23"></line>
            <line x1="8" y1="23" x2="16" y2="23"></line>
          </svg>
      </button>
      <div class="types">
        <label for="type-perfect"><input type="checkbox" id="type-perfect" name="rhymeType" value="perfect" checked>Perfect</label>
        <label for="type-assonance"><input type="checkbox" id="type-assonance" name="rhymeType" value="assonance" checked>Assonance</label>
        <label for="type-slant"><input type="checkbox" id="type-slant" name="rhymeType" value="slant" checked>Slant</label>
        <label for="type-pararhyme"><input type="checkbox" id="type-pararhyme" name="rhymeType" value="pararhyme" checked>Pararhyme</label>
        <label for="type-multisyllabic"><input type="checkbox" id="type-multisyllabic" name="rhymeType" value="multisyllabic" checked>Multisyllabic</label>
        <label for="type-eye"><input type="checkbox" id="type-eye" name="rhymeType" value="eye" checked>Eye</label>
      </div>
    </div>
    <div id="results"></div>
  </div>
  <div id="banner"></div>
  <script>
    let cmu = {}, wordList = [], debounceTimer, hasSearched = false;
    async function loadCMU() {
      const res = await fetch("cmudict.json");
      cmu = await res.json();
      for (let w in cmu) {
        if (!Array.isArray(cmu[w])) cmu[w] = [cmu[w]];
      }
      wordList = Object.keys(cmu);
      document.getElementById("status").innerText = "Dictionary loaded.";
    }
    function countSyllables(p) {
      return (p.match(/[0-2]/g) || []).length;
    }
    function getRhymePart(p) {
      const phones = p.split(" ");
      for (let i = phones.length - 1; i >= 0; i--) {
        if (phones[i].match(/\d/)) return phones.slice(i).join(" ");
      }
      return phones.join(" ");
    }
    function getAssonance(p) {
      return p.match(/[AEIOU][A-Z]*[0-2]?/g) || [];
    }
    function normalize(w) {
      return w.toUpperCase().replace(/[^A-Z]/g, "");
    }
    function matchRhyme(word, type) {
      word = normalize(word);
      if (!cmu[word]) return [];
      const target = cmu[word], out = [];
      wordList.forEach(cand => {
        if (cand === word) return;
        cmu[cand].forEach(pron => {
          target.forEach(tpron => {
            let ok = false;
            if (type === "perfect")
              ok = getRhymePart(pron) === getRhymePart(tpron);
            else if (type === "assonance")
              ok = getAssonance(pron).join("") === getAssonance(tpron).join("");
            else if (type === "slant")
              ok = getRhymePart(pron).replace(/\d/g, "") === getRhymePart(tpron).replace(/\d/g, "");
            else if (type === "pararhyme")
              ok = pron.replace(/[AEIOU][A-Z]*[0-2]?/g, "") ===
                   tpron.replace(/[AEIOU][A-Z]*[0-2]?/g, "");
            else if (type === "multisyllabic")
              ok = getRhymePart(pron) === getRhymePart(tpron) &&
                   countSyllables(pron) > 1;
            else if (type === "eye")
              ok = cand.slice(-3) === word.slice(-3);
            if (ok) out.push({ word: cand, syl: countSyllables(pron), type });
          });
        });
      });
      return out;
    }
    function dedupe(rows) {
      const map = {};
      rows.forEach(r => {
        const w = r.word.replace(/\(\d+\)$/, "").toLowerCase();
        const key = w + "|" + r.type;
        if (!map[key] || r.syl < map[key].syl) {
          map[key] = { word: w, syl: r.syl, type: r.type };
        }
      });
      return Object.values(map);
    }
    function renderResults(rows, types) {
      const container = document.getElementById("results");
      container.innerHTML = "";
      if (!rows.length) {
        container.innerHTML = "<p style='text-align:center;color:var(--text)'>No matches found.</p>";
        return;
      }
      types.forEach(type => {
        const group = rows.filter(r => r.type === type);
        if (!group.length) return;
        const col = document.createElement("div");
        col.className = "rhyme-col";
        col.innerHTML = <h2>${type}</h2><div class="words"></div>;
        const wordsEl = col.querySelector(".words");
        group.sort((a,b) => a.syl - b.syl).forEach(r => {
          const btn = document.createElement("div");
          btn.className = "word";
          btn.textContent = ${r.word} (${r.syl});
          btn.onclick = () => copyWord(r.word);
          wordsEl.appendChild(btn);
        });
        container.appendChild(col);
      });
    }
    function copyWord(w) {
      navigator.clipboard.writeText(w);
      const b = document.getElementById("banner");
      b.textContent = Copied “${w}”;
      b.classList.add("show");
      setTimeout(() => b.classList.remove("show"), 1200);
    }
    function doSearch() {
      const w = document.getElementById("inputWord").value.trim();
      const types = Array.from(
        document.querySelectorAll('input[name="rhymeType"]:checked')
      ).map(i => i.value);
      if (w && !hasSearched) {
        hasSearched = true;
        document.getElementById("app").classList.add("expanded");
      }
      let all = [];
      if (w) types.forEach(t => (all = all.concat(matchRhyme(w, t))));
      all = dedupe(all);
      renderResults(all, types);
    }
    function scheduleSearch() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(doSearch, 150);
    }
    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (window.SpeechRecognition) {
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = false;
      let recognizing = false;
      const micBtn = document.getElementById('micBtn');
      const inputEl = document.getElementById('inputWord');
      micBtn.addEventListener('click', () => {
        if (recognizing) {
          recognition.stop();
        } else {
          recognition.start();
        }
      });
      recognition.addEventListener('start', () => {
        recognizing = true;
        micBtn.classList.add('listening');
      });
      recognition.addEventListener('end', () => {
        recognizing = false;
        micBtn.classList.remove('listening');
        if (micBtn.classList.contains('listening')) {
          recognition.start();
        }
      });
      recognition.addEventListener('result', (event) => {
        const { transcript } = event.results[event.resultIndex][0];
        const word = transcript.trim().split(/\s+/).pop();
        inputEl.value = word;
        doSearch();
      });
    }
    window.onload = loadCMU;
    document.getElementById("inputWord").addEventListener("input", scheduleSearch);
    document.querySelectorAll('input[name="rhymeType"]').forEach(cb => cb.addEventListener("change", scheduleSearch));
  </script>
</body>
</html>